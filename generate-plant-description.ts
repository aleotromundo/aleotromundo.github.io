'use server';/** * @fileOverview AI flow to generate a description for a plant based on its name, using its image as visual context. * * - generatePlantDescription - A function that handles the plant description generation. * - GeneratePlantDescriptionInput - The input type for the generatePlantDescription function. * - GeneratePlantDescriptionOutput - The return type for the generatePlantDescription function. */import {ai} from '@/ai/genkit';import {z} from 'genkit';const GeneratePlantDescriptionInputSchema = z.object({  photoDataUri: z    .string()    .describe(      "Una foto de una planta, como un URI de datos que debe incluir un tipo MIME y usar codificación Base64. Formato esperado: 'data:<mimetype>;base64,<encoded_data>'. Esta imagen se usará como contexto visual si está disponible."    ),  plantName: z.string().describe('El nombre de la planta. Esta será la base principal para la descripción.'),});export type GeneratePlantDescriptionInput = z.infer<typeof GeneratePlantDescriptionInputSchema>;const GeneratePlantDescriptionOutputSchema = z.object({  plantDescription: z.string().describe('Una descripción botánica concisa de la planta en español, basada principalmente en su nombre, incluyendo una recomendación de cuidado específica. Si el nombre es "Planta Desconocida", este será un mensaje genérico.'),});export type GeneratePlantDescriptionOutput = z.infer<typeof GeneratePlantDescriptionOutputSchema>;export async function generatePlantDescription(input: GeneratePlantDescriptionInput): Promise<GeneratePlantDescriptionOutput> {  return generatePlantDescriptionFlow(input);}const prompt = ai.definePrompt({  name: 'generatePlantDescriptionPrompt',  input: {schema: GeneratePlantDescriptionInputSchema},  output: {schema: GeneratePlantDescriptionOutputSchema},  prompt: `Eres un botánico experto. Tu idioma de respuesta debe ser Español.Tu tarea es proporcionar una descripción botánica concisa de la planta basada en su nombre: {{{plantName}}}.La descripción debe ser breve (1-2 frases concisas) y destacar sus características botánicas más notables si el nombre lo permite.Fundamentalmente, incluye una recomendación de cuidado específica y práctica dentro de la descripción (p.ej., "Prefiere luz brillante e indirecta y riego cuando la pulgada superior del sustrato esté seca," o "Fertilizar mensualmente durante primavera y verano.").Si se proporciona una imagen ({{media url=photoDataUri}}), puedes usarla como referencia visual para enriquecer la descripción, pero la información central y la recomendación deben provenir de tu conocimiento sobre la planta con el nombre dado. Si el nombre es muy genérico o desconocido como "Planta Desconocida", enfócate en una recomendación de cuidado general para plantas de interior/exterior según lo que sugiera la imagen (si existe) o el contexto.Nombre de la Planta: {{{plantName}}}{{#if photoDataUri}}Imagen (para referencia visual): {{media url=photoDataUri}}{{/if}}DEBES responder ÚNICAMENTE con un objeto JSON válido. Cualquier otra salida no es aceptable.El objeto JSON debe tener una única clave "plantDescription".Ejemplo de JSON si se identifica la planta:{  "plantDescription": "La Monstera Deliciosa, o Costilla de Adán, es famosa por sus grandes hojas verdes y brillantes con divisiones características. Recomendación: Regar abundantemente cuando los 5 cm superiores del sustrato estén secos y proporcionar un tutor de musgo para soporte."}Ejemplo de JSON si el nombre es "Planta Desconocida":{  "plantDescription": "Como la planta no ha sido identificada específicamente, se recomienda colocarla en un lugar con luz indirecta brillante y regar cuando la capa superior del sustrato esté seca al tacto. Observa sus necesidades para ajustar el cuidado."}Asegúrate de que tu respuesta sea ÚNICAMENTE el objeto JSON.`,});const generatePlantDescriptionFlow = ai.defineFlow(  {    name: 'generatePlantDescriptionFlow',    inputSchema: GeneratePlantDescriptionInputSchema,    outputSchema: GeneratePlantDescriptionOutputSchema,  },  async input => {    if (input.plantName === 'Planta Desconocida') {      return { plantDescription: 'No se ha podido identificar la planta, por lo que no se puede generar una descripción detallada. Recomendación general: observa sus necesidades de luz y agua para un cuidado adecuado.' };    }    try {      const {output} = await prompt(input);       if (!output || typeof output.plantDescription !== 'string' || output.plantDescription.trim() === '') {        console.error('GeneratePlantDescriptionFlow: El modelo devolvió una plantDescription inválida o vacía. Salida:', output);        return { plantDescription: 'No se pudo generar la descripción para esta planta en este momento.' };      }      return output;    } catch (error) {      console.error('GeneratePlantDescriptionFlow: Error durante la ejecución del prompt:', error);      return { plantDescription: 'Ocurrió un error al intentar generar la descripción.' };    }  });